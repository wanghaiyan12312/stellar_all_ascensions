## fix compatible between cyber and psionic
####
create_cyber_species_effect = {
	species = {
		modify_species = {
			effect = {
				create_species = {
					is_mod = yes
					name = this
					plural = this
					class = this
					portrait = this
					traits = this
					can_be_modified = this
					homeworld = this
					namelist = this
					gender = this
					traits = {
						ideal_planet_class = this
					}
				}
				last_created_species = {
					change_species_characteristics = {
						add_trait = trait_cybernetic
					}

					save_global_event_target_as = cyberspecies@prev
				}
			}
		}
	}
}

create_cyber_creed_species_effect = {
	species = {
		modify_species = {
			effect = {
				create_species = {
					is_mod = yes
					name = this
					plural = this
					class = this
					portrait = this
					traits = this
					can_be_modified = this
					homeworld = this
					namelist = this
					gender = this
					traits = {
						ideal_planet_class = this
					}
				}
				last_created_species = {
					change_species_characteristics = {
						remove_trait = trait_cyborg_creed_of_construction
						remove_trait = trait_cyborg_creed_of_war
						remove_trait = trait_cyborg_creed_of_research
						remove_trait = trait_cyborg_creed_of_labor
						remove_trait = trait_cyborg_ritualistic_implants
						add_trait = trait_cybernetic
					}

					save_global_event_target_as = cybercreedspecies@root.owner
				}
			}
		}
	}
}

# Requires: event_target:changing_species and event_target:cyberspecies@species
cyberize_leaders_effect = {
	every_owned_leader = {
		limit = {
			exists = event_target:cyberspecies@species
			exists = event_target:changing_species
			is_exact_same_species = event_target:changing_species
			NOR = {
				has_trait = leader_trait_cyborg
				has_trait = leader_trait_limited_cyborg
			}
			OR = {
				is_spiritualist = no
				owner = { has_country_flag = cyber_force_objectors }
			}
		}
		change_species = event_target:cyberspecies@species
		add_trait = {
			trait = leader_trait_cyborg
			show_message = no
		}
	}
	every_pool_leader = {
		limit = {
			exists = event_target:cyberspecies@species
			exists = event_target:changing_species
			is_exact_same_species = event_target:changing_species
			NOR = {
				has_trait = leader_trait_cyborg
				has_trait = leader_trait_limited_cyborg
			}
			OR = {
				is_spiritualist = no
				owner = { has_country_flag = cyber_force_objectors }
			}
		}
		change_species = event_target:cyberspecies@species
		add_trait = {
			trait = leader_trait_cyborg
			show_message = no
		}
	}
	update_node_portraits_if_gestalt_effect = yes
}

# Requires: event_target:changing_species and event_target:cyberspecies@species
cyberize_leaders_limited_effect = {
	every_owned_leader = {
		limit = {
			exists = event_target:cyberspecies@species
			exists = event_target:changing_species
			is_exact_same_species = event_target:changing_species
			NOR = {
				has_trait = leader_trait_cyborg
				has_trait = leader_trait_limited_cyborg
			}
			is_spiritualist = yes
		}
		change_species = event_target:cyberspecies@species
		add_trait = {
			trait = leader_trait_limited_cyborg
			show_message = no
		}
	}
	every_pool_leader = {
		limit = {
			exists = event_target:cyberspecies@species
			exists = event_target:changing_species
			is_exact_same_species = event_target:changing_species
			NOR = {
				has_trait = leader_trait_cyborg
				has_trait = leader_trait_limited_cyborg
			}
			is_spiritualist = yes
		}
		change_species = event_target:cyberspecies@species
		add_trait = {
			trait = leader_trait_limited_cyborg
			show_message = no
		}
	}
}
####
# remove the advance government
aap_remove_government_flags = {
	remove_country_flag = cyber_individualist
	remove_country_flag = cyber_collectivist
	remove_country_flag = bio_cloning
	remove_country_flag = bio_mutation
	remove_country_flag = bio_purity
	remove_country_flag = transcendent_government
	remove_country_flag = corporeal_government
	every_owned_leader = {
		limit = {
			OR = {
				has_trait = trait_leader_genetic_purist				
			}
		}
		remove_trait = trait_leader_genetic_purist
	}
	every_pool_leader = {
		limit = {
			OR = {
				has_trait = trait_leader_genetic_purist		
			}
		}
		remove_trait = trait_leader_genetic_purist
	}
}

# remove all repeatable phy tech allow flag 
auto_tech_remove_all_phy_flag = {
	remove_country_flag = energy_fire_rate_allow
	remove_country_flag = energy_damage_allow
	remove_country_flag = energy_output_allow
	remove_country_flag = shield_output_allow
}

# remove all repeatable soc tech allow flag 
auto_tech_remove_all_soc_flag = {
	remove_country_flag = strike_craft_fire_rate_allow
	remove_country_flag = strike_craft_fire_damage_allow
	remove_country_flag = army_health_allow
	remove_country_flag = army_damage_allow
	remove_country_flag = food_output_allow
	remove_country_flag = core_system_cap_allow
	remove_country_flag = leader_life_span_allow
}

# remove all repeatable eng tech allow flag 
auto_tech_remove_all_eng_flag = {
	remove_country_flag = kinetic_fire_rate_allow
	remove_country_flag = kinetic_damage_allow
	remove_country_flag = explosive_fire_rate_allow
	remove_country_flag = explosive_damage_allow
	remove_country_flag = military_station_health_allow
	remove_country_flag = military_station_damage_allow
	remove_country_flag = mineral_output_allow
	remove_country_flag = armor_output_allow
}


can_harvest_dna = {
	# Genetic ascension requires Utopia or BioGenesis
	OR = {
		has_utopia = yes
		has_biogenesis_dlc = yes
	}
	# Only regular empires and hive-minds can genetically ascend.
	is_machine_empire = no
	# If you've taken other ascension path, we shouldn't let you harvest DNA anymore.
#	NOR = {
#		has_cybernetic_ascension = yes
#		has_psionic_ascension = yes
#		has_synthetic_ascension = yes
#		has_country_flag = genetic_ascension_stage_3_purity
#		has_country_flag = genetic_ascension_stage_3_cloning
#	}
}

can_harvest_parts = {
	has_machine_age_dlc = yes
	OR = {
		has_technology = tech_neuro_quantum_links
		has_technology = tech_synthetic_workers
		has_technology = tech_binary_motivators
	}
	# Only machine empires and cyborgs can use mechanical leviathan parts.
	OR = {
		has_active_tradition = tr_cybernetics_integrated_anatomy
		has_active_tradition = tr_cybernetics_assimilator_integrated_anatomy
		is_synthetic_empire = yes
	}
	# If you've taken another ascension path, we shouldn't let you harvest parts anymore.
#	NOR = {
#		has_genetic_ascension = yes
#		has_psionic_ascension = yes
#	}
}